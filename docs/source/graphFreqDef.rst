How Frequency is calculated in mapPat
-------------------------------------

mapPat represents pathogens circulation by showing changes in the relative frequency of variants, lineages and mutations. However, frequency is calculated in slightly different ways depending on the available data.

+ **Global frequency**
	| Global frequency is computed, with respect to the interval of time set by the user, as the ratio between the total number of genomes associated to a variant, lineage or mutation and the total number of available genomes. It can be calculated both nationally and regionally.

+ **Pointwise frequency**
	| Represents the frequency of a variant, lineage or mutation at a single time point (week or month). It is calculated as the ratio between the number of genomes associated to a variant, lineage or mutation and the total number of genomes sequenced nationally at that week/month.

+ **Relative frequency (global or pointwise)**
	| Represents the global/pointwise frequency of a lineage and/or mutation relative to a variant or lineage of choice. Specifically, every time a selection is performed only data associated with the selected variant or lineage is considered for the computation of global and pointwise frequencies.

The example below illustrates the calculation of global, pointwise and relative frequencies using data from the BA.1 Omicron sublineage in Italy as a use case; more precisely, national and regional data (Apulia) from week 96 to week 113.

The number of BA.1 genomes sequenced each week in Italy during the selected interval of time is reported below:

	+------------+----+----+----+----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
	|            | 96 | 97 | 98 | 99 | 100 | 101 | 102 | 103 | 104 | 105 | 106 | 107 | 108 | 109 | 110 | 111 | 112 | 113 |
	+============+====+====+====+====+=====+=====+=====+=====+=====+=====+=====+=====+=====+=====+=====+=====+=====+=====+
	| BA.1_Italy | 0  | 0  | 1  | 0  | 4   | 5   | 33  | 188 | 378 | 725 | 307 | 497 | 277 | 500 | 246 | 150 | 95  | 61  |
	+------------+----+----+----+----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+

While matched data, but only for the Apulia region is the following:

	+-------------+----+----+----+----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
	|             | 96 | 97 | 98 | 99 | 100 | 101 | 102 | 103 | 104 | 105 | 106 | 107 | 108 | 109 | 110 | 111 | 112 | 113 |
	+=============+====+====+====+====+=====+=====+=====+=====+=====+=====+=====+=====+=====+=====+=====+=====+=====+=====+
	| BA.1_Apulia | 0  | 0  | 0  | 0  | 0   | 0   | 8   | 7   | 3   | 10  | 2   | 2   | 1   | 15  | 0   | 0   | 0   | 0   |
	+-------------+----+----+----+----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Based on these data the global number of BA.1 genomes is:

	+-------------------+------+
	| Total_BA.1_Italy  | 3467 |
	+-------------------+------+
	| Total_BA.1_Apulia | 48   |
	+-------------------+------+

The total number of SARS-CoV-2 genomes sequenced weekly in Italy, during the same time period, is represented in this table:

	+------------------+-------+-------+-------+-------+--------+--------+--------+--------+--------+-------+--------+--------+--------+-------+--------+--------+-------+-------+
	|                  | 96    | 97    | 98    | 99    | 100    | 101    | 102    | 103    | 104    | 105   | 106    | 107    | 108    | 109   | 110    | 111    | 112   | 113   |
	+==================+=======+=======+=======+=======+========+========+========+========+========+=======+========+========+========+=======+========+========+=======+=======+
	| SARS-CoV-2_Italy | 1667  | 2689  | 2032  | 2157  | 1287   | 3209   | 1813   | 2848   | 2589   | 4102  | 1849   | 3167   | 1881   | 3338  | 2177   | 1644   | 968   | 532   |
	+------------------+-------+-------+-------+-------+--------+--------+--------+--------+--------+-------+--------+--------+--------+-------+--------+--------+-------+-------+

Also in this case the same information is available also for single regions (Apulia in the example).

	+-------------------+-------+-------+-------+-------+--------+--------+--------+--------+--------+-------+--------+--------+--------+-------+--------+--------+-------+-------+
	|                   | 96    | 97    | 98    | 99    | 100    | 101    | 102    | 103    | 104    | 105   | 106    | 107    | 108    | 109   | 110    | 111    | 112   | 113   |
	+===================+=======+=======+=======+=======+========+========+========+========+========+=======+========+========+========+=======+========+========+=======+=======+
	| SARS-CoV-2_Apulia | 45    | 19    | 15    | 27    | 9      | 41     | 12     | 73     | 38     | 70    | 26     | 28     | 19     | 94    | 14     | 11     | 9     | 1     |
	+-------------------+-------+-------+-------+-------+--------+--------+--------+--------+--------+-------+--------+--------+--------+-------+--------+--------+-------+-------+

Based on these data the total number of SARS-CoV-2 sequences is:

	+-------------------------+-------+
	| Total_SARS-CoV-2_Italy  | 39949 |
	+-------------------------+-------+
	| Total_SARS-CoV-2_Apulia | 551   |
	+-------------------------+-------+

The global frequency of BA.1, both nationally and regionally, is calculated as follows:

.. math::

	National\ global\ frequency\ =\ \frac{Total\_BA.1\_Italy}{Total\_SARS-CoV-2\_Italy}*100\ =\ \frac{3467}{39949}*100\ =\ 8.68\%
	
	Regional\ global\ frequency\ =\ \frac{Total\_BA.1\_Apulia}{Total\_SARS-CoV-2\_Apulia}*100\ =\ \frac{48}{551}*100\ =\ 8.71\%

Similarly, pointwise frequency is calculated as the ratio between the number of BA.1 genomes and the total number of SARS-CoV-2 genomes sequenced in Italy, but on a weekly basis. An example is illustrated below:

	+---------------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+-----------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+----------------------+----------------------+
	|                           | 96                   | 97                   | 98                   | 99                   | 100                  | 101                  | 102                   | 103                    | 104                    | 105                    | 106                    | 107                    | 108                    | 109                    | 110                    | 111                    | 112                  | 113                  |
	+===========================+======================+======================+======================+======================+======================+======================+=======================+========================+========================+========================+========================+========================+========================+========================+========================+========================+======================+======================+
	|  BA.1 pointwise frequency |:math:`\frac{0}{1667}`|:math:`\frac{0}{2689}`|:math:`\frac{1}{2032}`|:math:`\frac{0}{2157}`|:math:`\frac{4}{1287}`|:math:`\frac{5}{3209}`|:math:`\frac{33}{1813}`|:math:`\frac{188}{2848}`|:math:`\frac{378}{2589}`|:math:`\frac{725}{4102}`|:math:`\frac{307}{1849}`|:math:`\frac{497}{3167}`|:math:`\frac{277}{1881}`|:math:`\frac{500}{3338}`|:math:`\frac{246}{2177}`|:math:`\frac{150}{1644}`|:math:`\frac{95}{968}`|:math:`\frac{61}{532}`|
	+---------------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+-----------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+----------------------+----------------------+

	+--------------------------+-------+-------+-------+-------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+-------+--------+
	|                          | 96    | 97    | 98    | 99    | 100    | 101    | 102    | 103    | 104    | 105    | 106    | 107    | 108    | 109    | 110    | 111    | 112   | 113    |
	+==========================+=======+=======+=======+=======+========+========+========+========+========+========+========+========+========+========+========+========+=======+========+
	| BA.1 pointwise frequency | 0.00% | 0.00% | 0.05% | 0.00% | 0.31%  | 0.16%  | 1.82%  | 6.60%  | 14.60% | 17.67% | 16.60% | 15.69% | 14.73% | 14.98% | 11.30% | 9.12%  | 9.81% | 11.47% |
	+--------------------------+-------+-------+-------+-------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+-------+--------+


Relative global/pointwise frequencies are computed by applying the same computations, but considering only data limited to a previously selected variant or lineage of choice. The example below illustrates the computation of the relative frequency of BA.1 in the context of the lineages of the Omicron variant (and not with respect to the circulation of SARS-CoV-2 in general).

The number of SARS-CoV-2 genomes assigned to the Omicron variant sequenced weekly in Italy is reported in the following table:

	+------------------+-------+-------+-------+-------+--------+--------+--------+--------+--------+-------+--------+--------+--------+-------+--------+--------+-------+-------+
	|                  | 96    | 97    | 98    | 99    | 100    | 101    | 102    | 103    | 104    | 105   | 106    | 107    | 108    | 109   | 110    | 111    | 112   | 113   |
	+==================+=======+=======+=======+=======+========+========+========+========+========+=======+========+========+========+=======+========+========+=======+=======+
	| Omicron_Italy    | 1     | 0     | 1     | 0     | 5      | 20     | 97     | 668    | 1583   | 3268  | 1645   | 2987   | 1805   | 3290  | 2156   | 1614   | 964   | 531   |
	+------------------+-------+-------+-------+-------+--------+--------+--------+--------+--------+-------+--------+--------+--------+-------+--------+--------+-------+-------+

Meaning that the total number of sequences from the Omicron variant equals to:

	+----------------------+-------+
	| Total_Omicron_Italy  | 20635 |
	+----------------------+-------+

The relative global frequency of BA.1 in Italy as a lineage from the Omicron variant is:

.. math::

	Relative\ global\ frequency\ =\ \frac{Total\_BA.1\_Italy}{Total\_Omicron\_Italy}*100\ =\ \frac{3467}{20635}*100\ =\ 16.80\%

While the relative pointwise frequency of BA.1 is:

	+------------------------------------+-------------------+-------------------+-------------------+-------------------+-------------------+--------------------+---------------------+-----------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+----------------------+----------------------+
	|                                    | 96                | 97                | 98                | 99                | 100               | 101                | 102                 | 103                   | 104                    | 105                    | 106                    | 107                    | 108                    | 109                    | 110                    | 111                    | 112                  | 113                  |
	+====================================+===================+===================+===================+===================+===================+====================+=====================+=======================+========================+========================+========================+========================+========================+========================+========================+========================+======================+======================+
	|  BA.1 relative pointwise frequency |:math:`\frac{0}{1}`|:math:`\frac{0}{0}`|:math:`\frac{1}{1}`|:math:`\frac{0}{0}`|:math:`\frac{4}{5}`|:math:`\frac{5}{20}`|:math:`\frac{33}{97}`|:math:`\frac{188}{668}`|:math:`\frac{378}{1583}`|:math:`\frac{725}{3268}`|:math:`\frac{307}{1645}`|:math:`\frac{497}{2987}`|:math:`\frac{277}{1805}`|:math:`\frac{500}{3290}`|:math:`\frac{246}{2156}`|:math:`\frac{150}{1614}`|:math:`\frac{95}{964}`|:math:`\frac{61}{531}`|
	+------------------------------------+-------------------+-------------------+-------------------+-------------------+-------------------+--------------------+---------------------+-----------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+----------------------+----------------------+

	+-----------------------------------+-------+-------+---------+-------+---------+---------+---------+---------+--------+--------+--------+--------+--------+--------+--------+--------+-------+--------+
	|                                   | 96    | 97    | 98      | 99    | 100     | 101     | 102     | 103     | 104    | 105    | 106    | 107    | 108    | 109    | 110    | 111    | 112   | 113    |
	+===================================+=======+=======+=========+=======+=========+=========+=========+=========+========+========+========+========+========+========+========+========+=======+========+
	| BA.1 relative pointwise frequency | 0.00% | 0.00% | 100.00% | 0.00% | 80.00%  | 25.00%  | 34.02%  | 28.14%  | 23.88% | 22.18% | 18.66% | 16.64% | 15.35% | 15.20% | 11.41% | 9.29%  | 9.85% | 11.49% |
	+-----------------------------------+-------+-------+---------+-------+---------+---------+---------+---------+--------+--------+--------+--------+--------+--------+--------+--------+-------+--------+